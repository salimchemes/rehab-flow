<div class="plan-container" *ngIf="plan; else loading">
  <header class="header">
    <div class="logo" routerLink="/" style="cursor: pointer;">
      <div class="logo-icon">R</div>
      <span class="logo-text">RehabFlow</span>
    </div>
  </header>

  <main class="content">
    <div class="status-badge">
      <span class="dot"></span> Plan generado por IA
    </div>

    <h1 class="title">Tu plan de recuperaci贸n</h1>
    
    <div class="injury-summary">
      <h2>Diagn贸stico preliminar</h2>
      <p class="injury-name">{{ plan.resumen_lesion }}</p>
      <div class="meta">
        <span class="tag">Fase Actual</span>
      </div>
    </div>

    <div class="plan-preview">
      <h2>Objetivo de la Fase</h2>
      <p class="phase-objective">{{ plan.objetivo_fase }}</p>
      
      <!-- Free Content: Warning/Alerts -->
      <div class="section-card warning">
        <h3>Alertas y Se帽ales</h3>
        <ul class="alert-list">
          <li *ngFor="let alerta of plan.alertas">{{ alerta }}</li>
        </ul>
      </div>

      <div class="section-card info">
        <h3>Recomendaciones</h3>
        <p>{{ plan.recomendaciones }}</p>
      </div>

      <!-- Free Teaser (First Exercise only, or just blur all? User said "first block free". Let's show Alerts/Recs as free, Exercises as Paid) -->
      <!-- Let's actually SHOW the list but BLUR IT to tease content length -->
      <!-- Free Content: Exercises -->
      <div class="section-card">
        <h3>Ejercicios Recomendados</h3>
        <div class="exercise-list">
          <div class="exercise-card" *ngFor="let ex of plan.ejercicios">
            <div class="exercise-header">
              <h4>{{ ex.nombre }}</h4>
              <span class="pain-level">Dolor m谩x: {{ ex.nivel_dolor_permitido }}</span>
            </div>
            
            <!-- Media Placeholder -->
            <div class="media-placeholder">
              <div class="media-icon">讹</div>
              <span>Ver demostraci贸n</span>
            </div>

            <p class="instruction">{{ ex.instrucciones }}</p>
              <div class="exercise-meta">
              <span *ngIf="ex.series">Series: {{ ex.series }}</span>
              <span *ngIf="ex.repeticiones">Reps: {{ ex.repeticiones }}</span>
              <span *ngIf="ex.duracion">Duraci贸n: {{ ex.duracion }}</span>
            </div>
            <div class="warning-box" *ngIf="ex.que_evitar">
              锔 Evitar: {{ ex.que_evitar }}
            </div>
          </div>
        </div>
      </div>

      <!-- Locked Content: Progression & Advanced Details -->
      <div class="locked-section">
        <div [class.premium-blur]="!isPremium">
          
          <div class="section-card progression">
            <h3>Reglas de Progresi贸n</h3>
            <ul class="check-list">
              <li *ngFor="let regla of plan.reglas_progresion">{{ regla }}</li>
            </ul>
          </div>
        </div>

        <!-- Overlay -->
        <div class="premium-overlay" *ngIf="!isPremium">
          <div class="lock-icon"></div>
          <h3>Desbloquea las Reglas de Evoluci贸n</h3>
          <p style="margin-bottom: 2rem; color: #666; text-align: center; max-width: 80%;">
            Aprende cu谩ndo avanzar de fase y c贸mo evitar reca铆das.
          </p>
          <button class="premium-button" (click)="unlockPlan()" style="width: auto; padding-left: 2rem; padding-right: 2rem;">
            Desbloquear por $29.99
          </button>
        </div>
      </div>


    </div>
  </main>
</div>

<ng-template #loading>
  <div class="loading-container">
    <div class="spinner"></div>
    <p>Generando tu plan personalizado...</p>
  </div>
</ng-template>
